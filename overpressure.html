<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Explosion Control Room - Properties Layout</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: Calibri, Arial, sans-serif; margin: 0; background: #f5f8fa;}
    .container { max-width: 1080px; margin: 25px auto; background: #fff; border-radius: 10px; padding: 28px 38px; box-shadow: 0 2px 12px #b7b7b722;}
    h1 { font-size: 1.35rem; margin: 0; }
    h2 { font-size: 1.15rem; color: #222; margin-bottom: 3px; }
    .desc { color: #444; font-size: 0.98rem; margin-bottom: 14px;}
    .header-purple { color: #800080; }
    .section-title { color: #0086d7; margin-top: 28px; }
    .bold { font-weight: bold; }
    .input-row { display: flex; align-items: center; margin-bottom: 8px; }
    .input-label { min-width: 130px; font-weight: bold; color: #800080;}
    .input-field { width: 80px; padding: 4px 7px; font-size: 1rem;}
    .unit { margin-left: 5px; font-size: 0.93em;}
    select.input-field { width: auto;}
    table { border-collapse: collapse; width: 100%; margin-bottom: 32px; }
    th, td { border: 1px solid #bbb; padding: 7px 8px; text-align: left; }
    th { background: #00b0f0; color: #fff;}
    .table-sub th { background: #e6e6e6; color: #222;}
    .purple { color: #800080; }
    .blue { color: #1a6ee9;}
    .red { color: #c00; }
    .center { text-align: center;}
    .small { font-size: 0.96em;}
    .mb20 { margin-bottom: 20px;}
    .mt30 { margin-top: 30px;}
    .w80 { width:80px;}
    .w120 { width:120px;}
    .w150 { width:150px;}
    .legend { color: #333; font-size: 0.93em; background: #e6e6e6; border-radius: 3px; padding: 5px 12px; margin-bottom: 6px;}
    .color-red { color: #e04a4a;}
    .color-purple { color: #8d3c8c;}
    .color-blue { color: #315fa2;}
    .color-green { color: #2d8c2d;}
    .pink { background: #ffd5e5 !important; }
    .mt-2 { margin-top: 22px; }
    .solver-section {background: #e5f7ff; border-radius:6px; padding: 15px 25px 10px 25px; margin-bottom: 18px; border: 1px solid #b7e5fa;}
    .probit-table th { background: #e6e6e6; color: #333;}
    .probit-table { margin-bottom: 15px;}
    .solver-table th { background: #e6e6e6; color: #333;}
  </style>
</head>
<body>
  <div class="container">
    <h1>Thesis Propose</h1>
    <div class="desc">Penentuan Jarak Control Room Berbasis Trinitrotoluene<br>
      (TNT) Equivalent menggunakan Visual Basic for Applications (VBA)
    </div>

    <div class="section-title bold header-purple mb20">Chemical Compound</div>
    <div class="input-row">
      <span class="input-label">Chemical Compound:</span>
      <select class="input-field" id="compound"></select>
    </div>
    <div class="input-row">
      <span class="input-label">Volume:</span>
      <input class="input-field" id="volume" type="number" min="0" step="0.01">
      <span class="unit">m³</span>
    </div>
    <div class="input-row">
      <span class="input-label">Distance:</span>
      <input class="input-field" id="distance" type="number" min="0" step="0.01">
      <span class="unit">meters</span>
    </div>

    <h2 class="mt30">Properties</h2>
    <table>
      <tr>
        <th colspan="3">Properties</th>
        <th>Value</th>
        <th>Unit</th>
        <th colspan="4">Sources</th>
      </tr>
      <tr>
        <td colspan="3">Density</td>
        <td><input class="input-field w80" id="density" type="number" readonly></td>
        <td>kg/m³</td>
        <td colspan="4">@NIST</td>
      </tr>
      <tr>
        <td colspan="3">Heat of Explosion</td>
        <td><input class="input-field w80" id="heat_explosion" type="number" readonly></td>
        <td>kJ/kg</td>
        <td colspan="4">@CCPS, Crowl &amp; Louvar, DOE, NIST</td>
      </tr>
      <tr>
        <td colspan="3">Sound Velocity</td>
        <td><input class="input-field w80" id="sound_velocity" type="number" readonly></td>
        <td>m/s</td>
        <td colspan="4">@Crowl &amp; Louvar</td>
      </tr>
      <tr>
        <td colspan="3">Explosion Efficiency</td>
        <td><input class="input-field w80" id="expl_eff" type="number" readonly></td>
        <td>-</td>
        <td colspan="4">@Crowl &amp; Louvar</td>
      </tr>
      <tr>
        <td colspan="3">E<sub>TNT</sub></td>
        <td><input class="input-field w80" id="e_tnt" type="number" readonly></td>
        <td>kJ/kg</td>
        <td colspan="4">@CCPS, Crowl, Louvar, etc.</td>
      </tr>
    </table>

    <!-- Tabel 2: Parameters -->
    <h2>Parameters</h2>
    <table>
      <tr>
        <th colspan="3">Parameters</th>
        <th>Value</th>
        <th>Unit</th>
        <th colspan="4">Sources</th>
      </tr>
      <tr>
        <td colspan="3">(W) Mass Compound</td>
        <td><input class="input-field w80" id="mass" type="number" readonly></td>
        <td>kg</td>
        <td colspan="4">@NIST</td>
      </tr>
      <tr>
        <td colspan="3">(E) Total of Energy Compound</td>
        <td><input class="input-field w80" id="e_total" type="number" readonly></td>
        <td>kJ</td>
        <td colspan="4">@CCPS, Crowl &amp; Louvar, DOE, NIST</td>
      </tr>
      <tr>
        <td colspan="3">(W) TNT Equivalent</td>
        <td><input class="input-field w80" id="w_tnt" type="number" readonly></td>
        <td>kg</td>
        <td colspan="4">@Crowl &amp; Louvar</td>
      </tr>
      <tr>
        <td colspan="3">(Ze) Scaled Distance</td>
        <td><input class="input-field w80" id="ze" type="number" readonly></td>
        <td>m kg<sup>-1/3</sup></td>
        <td colspan="4">@Crowl &amp; Louvar</td>
      </tr>
      <tr>
        <td colspan="3">((Ps) Scaled Overpressure</td>
        <td><input class="input-field w80" id="ps" type="number" readonly></td>
        <td>-</td>
        <td colspan="4">@Crowl &amp; Louvar</td>
      </tr>
      <tr>
        <td colspan="3">(Pa) Ambient Pressure</td>
        <td><input class="input-field w80" id="pa" type="number" value="101.325" readonly></td>
        <td>kPa</td>
        <td colspan="4">@Crowl &amp; Louvar</td>
      </tr>
      <tr>
        <td colspan="3" class="red">(Po) Peak side-on Overpressure</td>
        <td><input class="input-field w80 color-red" id="po_crowl" type="number" readonly></td>
        <td>kPa</td>
        <td colspan="4">@Crowl</td>
      </tr>
      <tr>
        <td colspan="3" class="purple">(Po) Peak side-on Overpressure</td>
        <td><input class="input-field w80 color-purple" id="po_alonso" type="number" readonly></td>
        <td>kPa</td>
        <td colspan="4">@Alonso</td>
      </tr>
      <tr>
        <td colspan="3" class="blue">(Po) Peak side-on Overpressure</td>
        <td><input class="input-field w80 color-blue" id="po_sadovski" type="number" readonly></td>
        <td>kPa</td>
        <td colspan="4">@Sadovski</td>
      </tr>
    </table>

    <!-- ===== PROBIT ANALYSIS SECTION ===== -->
    <div class="solver-section mt-2">
      <h2 class="section-title">Probit Analysis</h2>
      <table class="probit-table">
        <tr>
          <th>Effect</th>
          <th>Probit Y (Crowl)</th>
          <th>% Affected (Crowl)</th>
          <th>Probit Y (Alonso)</th>
          <th>% Affected (Alonso)</th>
          <th>Probit Y (Sadovski)</th>
          <th>% Affected (Sadovski)</th>
        </tr>
        <tbody id="probit-tbody"></tbody>
      </table>
    </div>
  </div>
  <script>
    // --- Compound "database" (emulate your Sheet Compound!A2:J10) ---
    const compounds = [
      { name: 'TNT',   density: 1590, heat: 4184,  sound: 6000, eff: 0.33, etnt: 4184 },
      { name: 'ANFO',  density: 840,  heat: 3630,  sound: 4500, eff: 0.28, etnt: 4184 },
      { name: 'RDX',   density: 1800, heat: 5000,  sound: 7500, eff: 0.35, etnt: 4184 },
      { name: 'PETN',  density: 1770, heat: 5780,  sound: 8200, eff: 0.38, etnt: 4184 },
      { name: 'NG',    density: 1600, heat: 4720,  sound: 7200, eff: 0.30, etnt: 4184 },
      { name: 'HMX',   density: 1900, heat: 5600,  sound: 9100, eff: 0.38, etnt: 4184 }
    ];

    // --- Probit Table Parameter: K1, K2, type ---
    const probitTable = [
      { label: "Death from lung hemorrhage", k1: -77.1, k2: 6.91, type: "Po" },
      { label: "Eardrum ruptures",           k1: -15.6, k2: 1.93, type: "Po" },
      { label: "Deaths from impact",         k1: -46.1, k2: 4.82, type: "v" },
      { label: "Injuries from impact",       k1: -39.1, k2: 4.45, type: "v" },
      { label: "Injuries from flying fragments", k1: -27.1, k2: 4.26, type: "v" },
      { label: "Structural damage",          k1: -23.8, k2: 2.92, type: "Po" },
      { label: "Glass breakage",             k1: -18.1, k2: 2.79, type: "Po" }
    ];

    function populateCompounds() {
      const select = document.getElementById('compound');
      compounds.forEach((cmp, i) => {
        const opt = document.createElement('option');
        opt.value = cmp.name;
        opt.text = cmp.name;
        select.appendChild(opt);
      });
    }
    function getCompound(name) { return compounds.find(c => c.name === name) || compounds[0]; }

    function setPinkIfInvalid(el, valid) {
      if (!valid) el.classList.add('pink');
      else el.classList.remove('pink');
    }

    function normSDist(x) {
      var t = 1 / (1 + 0.2316419 * Math.abs(x));
      var d = 0.3989423 * Math.exp(-x * x / 2);
      var prob = d * t * (0.3193815 + t * (-0.3565638 + t * (1.781478 + t * (-1.821256 + t * 1.330274))));
      prob = 1 - prob;
      if (x < 0) prob = 1 - prob;
      return prob;
    }

    function recalc() {
      const cmpName = document.getElementById('compound').value;
      const cmp = getCompound(cmpName);
      const volume = parseFloat(document.getElementById('volume').value) || 0;
      const distance = parseFloat(document.getElementById('distance').value) || 0;

      document.getElementById('density').value         = cmp.density;
      document.getElementById('heat_explosion').value  = cmp.heat;
      document.getElementById('sound_velocity').value  = cmp.sound;
      document.getElementById('expl_eff').value        = cmp.eff;
      document.getElementById('e_tnt').value           = cmp.etnt;

      const density    = cmp.density;
      const heat       = cmp.heat;
      const eff        = cmp.eff;
      const e_tnt      = cmp.etnt;
      const pa         = 101.325;
      const mass       = volume * density;
      document.getElementById('mass').value            = isFinite(mass) && mass > 0 ? mass.toFixed(2) : "";

      const e_total    = mass * heat * eff;
      document.getElementById('e_total').value         = isFinite(e_total) && e_total > 0 ? e_total.toFixed(2) : "";

      const w_tnt      = e_tnt ? e_total / e_tnt : 0;
      document.getElementById('w_tnt').value           = isFinite(w_tnt) && w_tnt > 0 ? w_tnt.toFixed(2) : "";

      const ze         = w_tnt > 0 ? distance / Math.pow(w_tnt, 1/3) : 0;
      document.getElementById('ze').value              = isFinite(ze) && ze > 0 ? ze.toFixed(3) : "";

      let ps = 0;
      if (ze) ps = (1616 * (1 + Math.pow(ze / 4.5,2))) /
                   (Math.sqrt(1 + Math.pow(ze/0.048,2)) *
                    Math.sqrt(1 + Math.pow(ze/0.32,2)) *
                    Math.sqrt(1 + Math.pow(ze/1.35,2)));
      document.getElementById('ps').value              = isFinite(ps) && ps > 0 ? ps.toFixed(3) : "";

      // Peak overpressure (Crowl)
      const po_crowl = ps * pa;
      document.getElementById('po_crowl').value        = isFinite(po_crowl) && po_crowl > 0 ? po_crowl.toFixed(2) : "";

      // Alonso
      let po_alonso = 0;
      if (ze < 10 && ze > 0) po_alonso = (1130000 * Math.pow(ze, -2.01)) / 1000;
      else if (ze >= 10)     po_alonso = (183000 * Math.pow(ze, -1.16)) / 1000;
      document.getElementById('po_alonso').value       = isFinite(po_alonso) && po_alonso > 0 ? po_alonso.toFixed(2) : "";

      // Sadovski
      let po_sadovski = 0;
      if (distance > 0 && w_tnt > 0) {
        const y = Math.pow(w_tnt, 1/3) / distance;
        po_sadovski = (0.085 * y + 0.3 * Math.pow(y,2) + 0.8 * Math.pow(y,3)) * 1000;
      }
      document.getElementById('po_sadovski').value     = isFinite(po_sadovski) && po_sadovski > 0 ? po_sadovski.toFixed(2) : "";

      setPinkIfInvalid(document.getElementById('volume'),   !(volume > 0));
      setPinkIfInvalid(document.getElementById('distance'), !(distance > 0));

      // --- PROBIT TABLE ---
      // Use ONLY Po from Parameter Table for "Po"-type Probit
      const PoList = [
        parseFloat(document.getElementById('po_crowl').value)    || 0, // Crowl
        parseFloat(document.getElementById('po_alonso').value)   || 0, // Alonso
        parseFloat(document.getElementById('po_sadovski').value) || 0  // Sadovski
      ].map(p => p * 1000);
      const c0 = cmp.sound;
      const Pa_Pas = 101325;

      function vshock(Po) {
        return (Po > 0 && c0) ? c0 * Math.sqrt(7 * Po / (6 * Pa_Pas)) : 0;
      }
      const vList = [PoList[0], PoList[1], PoList[2]].map(Po => vshock(Po));

      const tbody = document.getElementById('probit-tbody');
      tbody.innerHTML = '';
      probitTable.forEach(row => {
        const tr = document.createElement('tr');
        let td1 = document.createElement('td'); td1.textContent = row.label; tr.appendChild(td1);
        [0,1,2].forEach(idx => {
          let x, Y, valType;
          if (row.type === "Po")      { x = PoList[idx]; valType = "Po"; }
          else if (row.type === "v")  { x = vList[idx]; valType = "v"; }
          if (x > 0)
            Y = row.k1 + row.k2 * Math.log(x);
          else
            Y = "";
          let td2 = document.createElement('td');
          td2.textContent = Y !== "" ? Y.toFixed(2) : "";
          tr.appendChild(td2);

          let perc = "";
          if (Y !== "") perc = (normSDist(Y - 5) * 100).toFixed(2) + "%";
          let td3 = document.createElement('td');
          td3.textContent = perc;
          tr.appendChild(td3);
        });
        tbody.appendChild(tr);
      });
    }

    function initEvents() {
      ["compound", "volume", "distance"].forEach(id => document.getElementById(id).addEventListener('input', recalc));
    }

    // --- INIT ---
    populateCompounds();
    initEvents();
    document.getElementById('compound').value = 'TNT';
    document.getElementById('volume').value = 3.5;
    document.getElementById('distance').value = 450;
    recalc();
  </script>
</body>
</html>
